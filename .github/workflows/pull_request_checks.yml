name: "Pull Request Checks"

on:
  pull_request:

jobs:
  ##
  # install
  ##

  install:
    name: "Install"
    runs-on: ubuntu-latest
    steps:
      - name: "ğŸ› Checkout"
        uses: actions/checkout@v4
      - name: "ğŸ”§ Setup"
        uses: ./.github/actions/use-dependencies

  ##
  # validatation
  ##

  validate_pr_title:
    name: "Validate PR Title"
    runs-on: ubuntu-latest
    steps:
      - name: "ğŸ› Checkout"
        uses: actions/checkout@v4
      - name: "ğŸ”§ Setup"
        uses: ./.github/actions/use-dependencies
      - name: "âœ… Validate"
        run: echo ${{ github.event.pull_request.title }} | dart run commitlint_cli

  ##
  # build
  ##

  build_android:
    name: "Build Android"
    needs: [validate_pr_title]
    runs-on: ubuntu-latest
    environment: development
    steps:
      - name: "ğŸ› Checkout"
        uses: actions/checkout@v4
      - name: "ğŸ”§ Setup"
        uses: ./.github/actions/use-dependencies
      - name: "ğŸ—ï¸ Build APK"
        run: flutter build apk
      - name: "ğŸ—ï¸ Build AppBundle"
        run: flutter build appbundle

  build_ios:
    name: "Build iOS"
    needs: [validate_pr_title]
    runs-on: macos-latest
    environment: development
    steps:
      - name: "ğŸ› Checkout"
        uses: actions/checkout@v4
      - name: "ğŸ”§ Setup"
        uses: ./.github/actions/use-dependencies
      - name: "ğŸ—ï¸ Build ios"
        run: flutter build ios --release --no-codesign
